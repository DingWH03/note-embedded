# 存储/主机（Storage/Host）

存储/主机接口的核心目的，是为系统提供**大容量、可持续的高速数据通道**与**可启动、可持久的代码与数据承载**：一方面把固件、日志、模型与媒体数据可靠地**落盘与取回**，另一方面把主控与外设/加速器/网卡等**高带宽端口**对接起来，并将热插拔设备与板载器件统一到可管理、可调度的 I/O 体系中。与板级外设“控制面”为主不同，这里更偏向**数据面**，强调吞吐、并发与完整性保障。

这类接口覆盖四类典型角色：其一是**非易失存储通道**（用于程序启动、数据持久化），可为板载器件或可拔插介质；其二是**主机互联通道**（连接高速外设与扩展槽），承担外设发现、带宽协商与中断/消息传递；其三是**内存接口**（易失存储），用于运行态的大规模读写与高速缓存；其四是**管理/引导路径**，负责从只读介质加载首段代码并在安全策略下建立信任根。无论哪一类，系统范式通常是**发起者/目标**或**主机/设备**模型，配合命令队列、DMA 与中断实现低开销传输。

共同特征可以概括为：**带宽优先、延迟受控、并发排队**。链路侧强调**多车道/多通道并行**与速率协商；控制面使用**命令—完成**与**深队列**提升 IOPS 与利用率；内存/缓存配合**零拷贝、散聚（scatter–gather）与环形缓冲**减少 CPU 参与度；在热插拔场景下，还需枚举、地址分配、资源映射与**电源状态机**来保证即插即用与低功耗。对实时性要求较高的应用，则通过**QoS/优先级、批处理窗口与中断抑制**在吞吐与尾延之间取舍。

通信与拓扑多为**点到点的高速差分串行**或**受严格时序约束的并行总线**。前者依赖链路训练、时钟恢复与均衡/预加重，按**帧/包**承载块数据，具备重传与流控能力；后者以**选通信号与数据选通信号**（如数据选通/写掩码/时钟对齐）约束时序，通过校准与训练达到位级对齐。语义上既有**块设备语义**（扇区/页为单位，提交/完成队列驱动）也有**内存映射语义**（按地址空间读写，支持一致性域与缓存策略），两者在操作系统中分别接入**块层/文件系统**与**内存子系统/驱动框架**。

电气与 SI/PI 角度，这些接口通常工作在**多 Gbps 级差分链路**或**高频并行线束**：设计要点包括**阻抗控制、长度与偏斜匹配、插/回损与通道预算**，以及连接器/FPC 的带宽与耐受；并行总线需关注**时钟抖动、走线拓扑（点对点/飞线/级联）、端接方式**与供电去耦。为降低 EMI 与误码率，链路常引入**扰码、FEC/CRC、重传**与**链路健康监测**；为避免插拔冲击与掉电损坏，电源侧采用**浪涌控制、掉电保护与写入屏障**等策略。

数据完整性与寿命管理是存储方向的重心。系统依靠**分层校验**（链路 CRC/协议级校验/文件系统校验）、**磨损均衡与坏块管理**、**写放大与垃圾回收优化**来保证介质长期可靠；对内存一侧则采纳**ECC/巡检**降低软错误风险。在安全方面，启动链路需**安全启动/镜像签名/密钥保护**，运行链路则通过**权限隔离、IOMMU 与加密通道**抵御越权 DMA 与数据窃听。

软件集成上，主机互联与块设备经由**驱动—队列—调度器**三层解耦：驱动负责适配控制器与队列，内核块层负责合并/重排与截止期调度，文件系统提供元数据一致性与崩溃恢复；高吞吐路径强调**批量提交、合并中断、轮询加速**与**IO 路径零拷贝**。内存接口通过**训练/校准**在启动期建立时序窗口，运行期结合**缓存策略、预取与 NUMA**保持带宽与延迟平衡。监控与排障依赖**链路计数器、SMART/健康信息、热图与尾延分布**，并以可重放的 I/O 工作负载进行回归。

从工程取舍看，存储/主机接口的价值在于为系统提供“快且稳”的数据底座。当分辨率/模型规模/并发连接增长时，常见演进路径包括**提升代际速率/增车道**、**引入压缩/卸载与协处理**、或在板级通过**重定时/均衡与更优连接器**延展距离与链路裕量；本质仍是在**带宽、尾延、功耗、成本、热设计与可维护性**之间找到可复用、可演进的平衡点。

## 1. 常见存储/主机接口

**QSPI/OSPI** 是 SPI 的多线并行扩展（4bit 或 8bit 数据线），典型速率数十到数百 Mbps。它常用于外部 NOR Flash 以提供更高的读写带宽，并支持 XIP（execute-in-place）直接从 Flash 运行代码。由于接口简单、成本低，广泛应用于嵌入式启动与固件存储。

**eMMC** 是一种将 NAND Flash 与控制器封装在单芯片内的存储方案，速率最高可达 HS400（约 400 MB/s）。它提供标准化块设备接口，支持磨损均衡与坏块管理，具备较高可靠性，广泛用于中高端移动设备与嵌入式系统。

**UFS**（Universal Flash Storage）是新一代嵌入式存储接口，采用高速差分串行物理层，带宽可达 1 GB/s 以上。它支持多队列并发与低延迟事务，具备良好的功耗控制和安全特性，常用于旗舰手机、平板与 AI 终端。

**SD/SDIO** 是可拔插的存储卡/外设接口，SDR104 模式下速率约 104 MB/s。其优势是热插拔与生态普及，常用于数据扩展与相机存储；而 SDIO 模式可挂接 Wi-Fi、蓝牙等低功耗外设。

**SATA** 是成熟的块存储接口，典型速率为 SATA III（600 MB/s）。其传输基于分组帧，支持热插拔与大容量设备，主要用于工业 PC、旧款嵌入式平台与兼容性要求高的场景。

**USB** 是通用外设与供电接口，速率从 USB 2.0（480 Mbps）到 USB4（20+ Gbps）。它既可承载存储设备（U 盘、移动硬盘），也能挂接网卡、摄像头、调试口，依托 Type-C 生态支持供电与替代模式。

**PCIe** 是现代高性能主机互联总线，采用点对点差分链路，线速从 Gen1（2.5 GT/s）到 Gen5（32 GT/s）。它支持多 lane 并行、DMA 与中断机制，是 NVMe SSD、GPU、FPGA 与高速网卡的首选互联方式。

**DDR/LPDDR** 是主存 DRAM 的接口，数据速率数 Gbps/bit，要求严格的时序校准与信号完整性设计。DDR 常用于高性能嵌入式与 PC，LPDDR 则面向低功耗移动平台。它决定了系统运行时的大规模带宽与延迟性能。

## 2. 典型对照表

### (1)非易失/卡类

| 协议               | 介质        |        典型吞吐 | 关键特性                    |
| ---------------- | --------- | ----------: | ----------------------- |
| QSPI/OSPI        | NOR Flash | 数十\~数百 Mbps | 启动/代码执行(XIP)、时序严谨       |
| eMMC (HS400)     | eMMC 芯片   |  \~400 MB/s | 成熟、易用、单芯片               |
| SD/SDIO (SDR104) | SD 卡/外设   |  \~104 MB/s | 热插拔；SDIO 常接 Wi‑Fi/BT 模块 |
| UFS (3.x/4.x)    | UFS 芯片    |     1+ GB/s | 并行队列、低延迟                |
| SATA (III)       | SSD/HDD   |  \~600 MB/s | 工业 PC/老平台兼容             |

### (2)高速互联

| 协议               | 物理 |                    线速 | 典型用途             |
| ---------------- | -- | --------------------: | ---------------- |
| USB 2.0/3.x/USB4 | 差分 | 480 Mbps / 5–20+ Gbps | 外设、供电、Type‑C 生态  |
| PCIe (Gen1–5)    | 差分 |      2.5–32 GT/s/lane | NVMe/加速卡/FPGA 互联 |
| DDR/LPDDR        | 混合 |            数 Gbps/bit | DRAM 内存接口        |
